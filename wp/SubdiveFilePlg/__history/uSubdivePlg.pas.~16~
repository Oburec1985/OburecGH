unit uSubdivePlg;

{$WARN SYMBOL_PLATFORM OFF}

interface

uses
  ComObj, ActiveX, SubdivFilePlg_TLB, Winpos_ole_TLB, StdVcl, windowsб POSBase;

type
  TSubdivePlgClass = class(TAutoObject, IWPPlugin)
  protected
    function Connect(const app: IDispatch): Integer; safecall;
    function Disconnect: Integer; safecall;
    function NotifyPlugin(what: Integer; var param: OleVariant): Integer; safecall;
  end;

var
  // указатель на тулбар винпоса
  bar_ID: Integer;
  ID_RunSubdiveFile: integer = 4;

implementation

uses ComServ;

function TSubdivePlgClass.Connect(const app: IDispatch): Integer;
var
  hbmp: cardinal;
begin
  WINPOS:=app as IWinPOS;
  // запоминаем тулбар винпоса
  bar_ID := WINPOS.CreateToolbar();
  // регистрация новой команды в винпос (запуск формы плагина)
  ID_RunSubdiveFile := WINPOS.RegisterCommand();
  // картинка для кнопочки которая будет связана с командой запуска формы
  // hinstans - глобальная переменная которая является идентификатором приложения
  hbmp := LoadBitmap(HInstance, 'SubdivePlgFrm');
  WINPOS.CreatetoolbarButton(bar_ID, ID_RunSubdiveFile, hbmp,'Разбить файл'#10'Разбить файл');
end;

function TSubdivePlgClass.Disconnect: Integer;
begin

end;

function TSubdivePlgClass.NotifyPlugin(what: Integer; var param: OleVariant): Integer;
begin
  // what = $1006 then  ADD_LINE нотификация о добавлении линии на график
  if what = 268828673 then
  begin
  end;
  // Del_LINE удаление линии с графика = $1007 then
  if what = 268894209 then
  begin
  end;
  // DEL_GRAPH удаление графика
  if HIWORD(what) = $1004 then
  begin
  end;
  // NODE_RENAMING = 0x101f0001
  if what = $101F0001 then
  begin
  end;
  // Нотификация прилинковки к дереву нового узла 0x00070001
  if what = $00070001 then
  begin
  end;
  // NODE_RENAMED = 0x10200001
  if what = $10200001 then
  begin
  end;
  // del_node = 270401537 событие удаления узла
  if what = $101E0001 then
  begin
  end;
  // запуск плагина
  if HIWORD(what) = ID_RunSubdiveFile then
  begin

  end;
  // Событие загрузки файла ((5 shl 16) or 1) или восстановления сеанса
  if what = 327681 then
  begin
  end;
  if what = $000A0001 then
  begin

  end;
end;

initialization
  TAutoObjectFactory.Create(ComServer, TSubdivePlgClass, Class_SubdivePlgClass,
    ciMultiInstance, tmApartment);
end.
